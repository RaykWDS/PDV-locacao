<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Locação de Veículos - Rostur Rent Car</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="styles.css"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }
    .navbar {
      background-color: #1a1a1a;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      color: white;
    }
    .logo-nav {
      height: 40px;
    }
    .logo-title h4 {
      margin: 0;
      font-size: 16px;
    }
    .navbar-button {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 5px;
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .logo {
      display: block;
      margin: 0 auto 10px;
      height: 60px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    form label {
      display: block;
      margin-top: 10px;
    }
    form input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    form button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    form button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

<script>
  if (sessionStorage.getItem('logado') !== 'true') {
    window.location.href = "../Login/login.html";
  }
</script>

<header class="navbar">
  <img src="Logo.png" alt="Logo" class="logo-nav">
  <div class="logo-title">
    <h4>Rostur Rent Car<br>Gestão de Frotas</h4>
  </div>
  <div class="navbar-content">
    <button class="navbar-button" id="logoutBtn">Sair</button>
  </div>
</header>

<div class="container">
  <img src="Logo.png" class="logo">
  <h2>Locação de Veículos<br>Rostur Rent Car</h2>
  <form id="locacaoForm">
    <label>Nome Completo:</label>
    <input type="text" id="nome" required>

    <label>CPF:</label>
    <input type="text" id="cpf" required>

    <label>Data de Nascimento:</label>
    <input type="date" id="nascimento" required>

    <label>CNH:</label>
    <input type="text" id="cnh" required>

    <label>Marca do Veículo:</label>
    <input type="text" id="marca" required>

    <label>Modelo do Veículo:</label>
    <input type="text" id="modelo" required>

    <label>Ano:</label>
    <input type="text" id="ano" required>

    <label>KM Entrega:</label>
    <input type="number" id="kmEntrega" required>

    <label>Horário de Entrega:</label>
    <input type="time" id="horaEntrega" required>

    <label>Horário de Devolução:</label>
    <input type="time" id="horaDevolucao" required>

    <label>Data de Entrega:</label>
    <input type="date" id="dataEntrega" required>

    <label>Data de Devolução:</label>
    <input type="date" id="dataDevolucao" required>

    <label>Nome do Locador:</label>
    <input type="text" id="vendedor" required>

    <label>Valor da Diária (R$):</label>
    <input type="number" id="valorDiaria" step="0.01" required>

    <label>Forma de Pagamento:</label>
    <input type="text" id="pagamento" required>

    <button type="button" onclick="gerarPDF()">Registrar locação</button>
  </form>
</div>

<script>
async function gerarPDF() {
  const { jsPDF } = window.jspdf;

  const nome = document.getElementById('nome').value;
  const cpf = document.getElementById('cpf').value;
  const nascimento = document.getElementById('nascimento').value;
  const cnh = document.getElementById('cnh').value;
  const marca = document.getElementById('marca').value;
  const modelo = document.getElementById('modelo').value;
  const ano = document.getElementById('ano').value;
  const kmEntrega = parseInt(document.getElementById('kmEntrega').value);
  const horaEntrega = document.getElementById('horaEntrega').value;
  const horaDevolucao = document.getElementById('horaDevolucao').value;
  const dataEntrega = document.getElementById('dataEntrega').value;
  const dataDevolucao = document.getElementById('dataDevolucao').value;
  const vendedor = document.getElementById('vendedor').value;
  const valorDiaria = parseFloat(document.getElementById('valorDiaria').value);
  const pagamento = document.getElementById('pagamento').value;

  const diferencaDias = Math.ceil((new Date(dataDevolucao) - new Date(dataEntrega)) / (1000 * 60 * 60 * 24)) || 1;
  const valorTotal = valorDiaria * diferencaDias;

  const pdf = new jsPDF();
  const pageWidth = pdf.internal.pageSize.getWidth();
  const logo = await fetch('Logo.png')
    .then(res => res.blob())
    .then(blob => new Promise(resolve => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.readAsDataURL(blob);
    }));

  pdf.addImage(logo, 'PNG', 10, 5, 30, 30);
  pdf.setFontSize(18);
  pdf.text("Rostur Rent Car", 45, 15);
  pdf.setFontSize(12);
  pdf.text("CNPJ: 00.000.000/0000-00", 45, 23);

  let y = 40;
  pdf.setFontSize(14);
  pdf.text("Dados do Cliente", 14, y);
  pdf.setFontSize(11);
  pdf.text(`Nome: ${nome}`, 14, y += 8);
  pdf.text(`CPF: ${cpf}`, 14, y += 7);
  pdf.text(`Nascimento: ${nascimento}`, 14, y += 7);
  pdf.text(`CNH: ${cnh}`, 14, y += 7);

  pdf.text("\nDados do Veículo", 14, y += 10);
  pdf.text(`Marca: ${marca}`, 14, y += 8);
  pdf.text(`Modelo: ${modelo}`, 14, y += 7);
  pdf.text(`Ano: ${ano}`, 14, y += 7);
  pdf.text(`KM Entrega: ${kmEntrega.toLocaleString('pt-BR')}`, 14, y += 7);

  pdf.text("\nHorários e Datas", 14, y += 10);
  pdf.text(`Entrega: ${horaEntrega}`, 14, y += 8);
  pdf.text(`Devolução: ${horaDevolucao}`, 14, y += 7);
  pdf.text(`Data de Entrega: ${dataEntrega}`, 14, y += 7);
  pdf.text(`Data de Devolução: ${dataDevolucao}`, 14, y += 7);
  pdf.text(`Valor da Diária: R$ ${valorDiaria.toFixed(2)}`, 14, y += 7);
  pdf.text(`Total: ${diferencaDias} diária(s): R$ ${valorTotal.toFixed(2)}`, 14, y += 7);
  pdf.text(`Forma de Pagamento: ${pagamento}`, 14, y += 7);

  pdf.text("\nLocador: ", 14, y += 10);
  pdf.text(`${vendedor}`, 14, y += 7);

  pdf.line(60, y += 20, 150, y);
  pdf.text("Assinatura do Cliente", 105, y + 7, { align: "center" });

  pdf.line(60, y += 25, 150, y);
  pdf.text("Assinatura do Locador", 105, y + 7, { align: "center" });

  pdf.setFontSize(10);
  pdf.text(`Emitido em: ${new Date().toLocaleString('pt-BR')}`, pageWidth / 2, 290, { align: "center" });

  pdf.save(`${nome}_locacao.pdf`);
}
</script>

<script>
  document.getElementById("logoutBtn").addEventListener("click", function() {
    sessionStorage.removeItem('logado');
    alert("Você foi desconectado.");
    window.location.href = "../Login/login.html";
  });
</script>

</body>
</html>
